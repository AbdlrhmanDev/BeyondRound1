# ุดุฑุญ ุฎูุงุฑุฒููุฉ ุญุณุงุจ ููุงุท ุงููุทุงุจูุฉ (Match Score)

## ๐ ูููุน ุงูููุฏ

### 1. ุฏุงูุฉ ุญุณุงุจ ุงูููุงุท (SQL Function)
**ุงูููู**: `supabase/migrations/20260107200858_694bcf31-17b0-4e14-9949-161588637e85.sql`
**ุงูุฏุงูุฉ**: `calculate_match_score(user_a_id uuid, user_b_id uuid)`

### 2. ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ูู Edge Function
**ุงูููู**: `supabase/functions/create-match-groups/index.ts`
**ุงูุณุทูุฑ**: 107-113

### 3. ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
**ุงูููู**: `src/pages/Matches.tsx`
**ุงูุณุทูุฑ**: 194-197

---

## ๐ข ููู ูุชู ุญุณุงุจ ุงูููุงุท

ุงูููุงุท ุงูุฅุฌูุงููุฉ = **100 ููุทุฉ** ููุณูุฉ ุนูู 4 ูุนุงููุฑ:

### 1. ููุงุท ุงูุงูุชูุงูุงุช (Interests Score) - 40% ูู ุงูููุงุท

**ุงูุญุณุงุจ**:
- ูุชู ุญุณุงุจ ุงูุงูุชูุงูุงุช ุงููุดุชุฑูุฉ ูู 4 ูุฆุงุช:
  - **Sports** (ุงูุฑูุงุถุฉ)
  - **Social Style** (ุฃุณููุจ ุงูุชูุงุตู ุงูุงุฌุชูุงุนู)
  - **Culture Interests** (ุงูุงูุชูุงูุงุช ุงูุซูุงููุฉ)
  - **Lifestyle** (ููุท ุงูุญูุงุฉ)

**ุงูุทุฑููุฉ**:
```sql
-- ูุซุงู: ุฅุฐุง ูุงู ุงููุณุชุฎุฏู A ูุฏูู [Football, Basketball, Tennis]
-- ูุงููุณุชุฎุฏู B ูุฏูู [Football, Swimming, Tennis]
-- ุงูุงูุชูุงูุงุช ุงููุดุชุฑูุฉ = [Football, Tennis] = 2
-- ุฅุฌูุงูู ุงูุงูุชูุงูุงุช = 3 + 3 = 6
-- ุงููุณุจุฉ = (2 * 2) / 6 = 0.67
-- ุงูููุงุท = 0.67 * 40 = 26.8 ููุทุฉ
```

**ููุงูุฃุฉ ุฅุถุงููุฉ**:
- ุฅุฐุง ูุงู ููุง ุงููุณุชุฎุฏููู ููุชููู ุจุงูุฃุนูุงู (`open_to_business = true`): +5 ููุงุท

**ุงูุญุฏ ุงูุฃูุตู**: 45 ููุทุฉ (40 + 5)

---

### 2. ููุงุท ุงูุชุฎุตุต (Specialty Score) - 30% ูู ุงูููุงุท

**ุงูุญุณุงุจ**:
- **ููุณ ุงูุชุฎุตุต**: 30 ููุทุฉ ูุงููุฉ
- **ุชุฎุตุตุงุช ูุฑุชุจุทุฉ**: ุญุณุจ ุฌุฏูู `specialty_relationships`
  - ูุซุงู: Internal Medicine + Cardiology = 0.8 * 30 = 24 ููุทุฉ
- **ุชุฎุตุตุงุช ุบูุฑ ูุฑุชุจุทุฉ**: 10 ููุงุท ููุท

**ุฌุฏูู ุงูุนูุงูุงุช ุจูู ุงูุชุฎุตุตุงุช**:
```sql
-- ุฃูุซูุฉ ูู specialty_relationships:
-- Internal Medicine + Cardiology = 0.8
-- Surgery + Orthopedics = 0.7
-- Pediatrics + Neonatology = 0.9
-- Psychiatry + Neurology = 0.6
```

**ุงูุญุฏ ุงูุฃูุตู**: 30 ููุทุฉ

---

### 3. ููุงุท ุงููููุน (Location Score) - 20% ูู ุงูููุงุท

**ุงูุญุณุงุจ**:
- **ููุณ ุงููุฏููุฉ**: 15 ููุทุฉ
- **ููุณ ุงูุญู + ููุณ ุงููุฏููุฉ**: 20 ููุทุฉ (ููุงูุฃุฉ ุฅุถุงููุฉ)
- **ูุฏู ูุฎุชููุฉ**: 0 ููุทุฉ

**ุงูุญุฏ ุงูุฃูุตู**: 20 ููุทุฉ

---

### 4. ููุงุท ุงูุชููุฑ (Availability Score) - 10% ูู ุงูููุงุท

**ุงูุญุณุงุจ**:
- ูุชู ุญุณุงุจ ุงูุฃููุงุช ุงููุชุงุญุฉ ุงููุดุชุฑูุฉ
- ูู ููุช ูุดุชุฑู = 3 ููุงุท
- **ุงูุญุฏ ุงูุฃูุตู**: 10 ููุงุท (ุญุชู ูู ูุงู ููุงู ุฃูุซุฑ ูู 3 ุฃููุงุช ูุดุชุฑูุฉ)

**ูุซุงู**:
- 1 ููุช ูุดุชุฑู = 3 ููุงุท
- 2 ุฃููุงุช ูุดุชุฑูุฉ = 6 ููุงุท
- 3+ ุฃููุงุช ูุดุชุฑูุฉ = 10 ููุงุท (ุญุฏ ุฃูุตู)

---

## ๐ ูุซุงู ุนููู

### ุงููุณุชุฎุฏู A:
- **ุงูุงูุชูุงูุงุช**: [Football, Basketball, Tennis]
- **ุงูุชุฎุตุต**: Internal Medicine
- **ุงููุฏููุฉ**: Riyadh
- **ุงูุฃููุงุช ุงููุชุงุญุฉ**: [Monday 6PM, Friday 7PM]

### ุงููุณุชุฎุฏู B:
- **ุงูุงูุชูุงูุงุช**: [Football, Swimming, Tennis]
- **ุงูุชุฎุตุต**: Cardiology
- **ุงููุฏููุฉ**: Riyadh
- **ุงูุฃููุงุช ุงููุชุงุญุฉ**: [Monday 6PM, Saturday 8PM]

### ุงูุญุณุงุจ:

1. **ููุงุท ุงูุงูุชูุงูุงุช**:
   - ุงููุดุชุฑูุฉ: [Football, Tennis] = 2
   - ุงูุฅุฌูุงูู: 3 + 3 = 6
   - ุงููุณุจุฉ: (2 * 2) / 6 = 0.67
   - ุงูููุงุท: 0.67 * 40 = **26.8 ููุทุฉ**

2. **ููุงุท ุงูุชุฎุตุต**:
   - Internal Medicine + Cardiology = ูุฑุชุจุทุงู (0.8)
   - ุงูููุงุท: 0.8 * 30 = **24 ููุทุฉ**

3. **ููุงุท ุงููููุน**:
   - ููุณ ุงููุฏููุฉ (Riyadh) = **15 ููุทุฉ**

4. **ููุงุท ุงูุชููุฑ**:
   - ููุช ูุดุชุฑู ูุงุญุฏ (Monday 6PM) = **3 ููุงุท**

### **ุงูููุงุท ุงูุฅุฌูุงููุฉ**: 26.8 + 24 + 15 + 3 = **68.8 ููุทุฉ**

---

## ๐ ููู ูุชู ุงุณุชุฎุฏุงู ุงูุญุณุงุจ

### 1. ูู Edge Function (`create-match-groups`)

```typescript
// ุงูุณุทูุฑ 107-113
const { data: score, error: scoreError } = await supabase.rpc(
  "calculate_match_score",
  {
    user_a_id: userA,
    user_b_id: userB,
  }
);

// ุฅุฐุง ูุงูุช ุงูููุงุท ุฃูู ูู 20ุ ูุง ูุชู ุฅูุดุงุก match
if (scoreError || !score || score < 20) return null;
```

**ุงูุญุฏ ุงูุฃุฏูู**: 20 ููุทุฉ (ูุฌุจ ุฃู ูููู ุงูููุงุท 20 ุฃู ุฃูุซุฑ ูุฅูุดุงุก match)

### 2. ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (`Matches.tsx`)

```typescript
// ุงูุณุทูุฑ 194-197
const { data: scoreResult } = await supabase.rpc("calculate_match_score", {
  user_a_id: user.id,
  user_b_id: memberId,
});

// ูุชู ุญุณุงุจ ูุชูุณุท ุงูููุงุท ูุน ุฌููุน ุฃุนุถุงุก ุงููุฌููุนุฉ
averageScore = scores.reduce((a, b) => a + b, 0) / scores.length;
```

---

## ๐ ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ

### 1. `onboarding_preferences`
ูุญุชูู ุนูู:
- `sports` (array)
- `social_style` (array)
- `culture_interests` (array)
- `lifestyle` (array)
- `specialty` (text)
- `availability_slots` (array)
- `open_to_business` (boolean)

### 2. `profiles`
ูุญุชูู ุนูู:
- `city` (text)
- `neighborhood` (text)

### 3. `specialty_relationships`
ูุญุชูู ุนูู:
- `specialty_1` (text)
- `specialty_2` (text)
- `relationship_score` (numeric) - ูู 0.0 ุฅูู 1.0

---

## ๐ฏ ููุฎุต

| ุงููุนูุงุฑ | ุงููุฒู | ุงูุญุฏ ุงูุฃูุตู | ุงูุดุฑุท |
|---------|------|-------------|--------|
| ุงูุงูุชูุงูุงุช | 40% | 45 ููุทุฉ | Jaccard similarity + business bonus |
| ุงูุชุฎุตุต | 30% | 30 ููุทุฉ | ููุณ ุงูุชุฎุตุต = 30ุ ูุฑุชุจุท = 0.8*30ุ ูุฎุชูู = 10 |
| ุงููููุน | 20% | 20 ููุทุฉ | ููุณ ุงููุฏููุฉ = 15ุ ููุณ ุงูุญู = 20 |
| ุงูุชููุฑ | 10% | 10 ููุงุท | ูู ููุช ูุดุชุฑู = 3 ููุงุท (ุญุฏ ุฃูุตู 10) |
| **ุงูุฅุฌูุงูู** | **100%** | **100 ููุทุฉ** | |

---

## ๐ ุงุฎุชุจุงุฑ ุงูุญุณุงุจ

ููููู ุงุฎุชุจุงุฑ ุญุณุงุจ ุงูููุงุท ูุฏููุงู:

```sql
-- ุญุณุงุจ ุงูููุงุท ุจูู ูุณุชุฎุฏููู ูุญุฏุฏูู
SELECT calculate_match_score(
  'user_id_1'::uuid,
  'user_id_2'::uuid
) as match_score;
```

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช

- **ุงูุญุฏ ุงูุฃุฏูู ูููุทุงุจูุฉ**: 20 ููุทุฉ (ูู `create-match-groups/index.ts`)
- **ุงูุญุฏ ุงูุฃูุตู**: 100 ููุทุฉ
- **ุงูุชูุฑูุจ**: ูุชู ุชูุฑูุจ ุงููุชูุฌุฉ ุฅูู ููุฒูุฉ ุนุดุฑูุฉ ูุงุญุฏุฉ
